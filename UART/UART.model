<!DOCTYPE Robei>
<Module Color="#f5f5dc" Y="0" Width="1024" File="Current/UART.model" Comment="" Type="module" Class="module" Name="UART" Code=" reg [7:0] cnt;&#xa;/*  捕获rx的下降沿，即起始信号  */    &#xa;  reg trigger_r0;&#xa;reg [3:0]count;&#xa;  wire neg_tri;&#xa;always@(posedge clk16x or negedge rst_n)  /*下降沿使用全局时钟来捕获的，其实用clk16x来捕获也可以*/&#xa;  begin&#xa;      if(!rst_n)&#xa;          begin&#xa;             trigger_r0&lt;=1'b0;&#xa;          end&#xa;      else&#xa;         begin    &#xa;              trigger_r0&lt;=rx;&#xa;          end&#xa;  end&#xa;  &#xa;  assign neg_tri = trigger_r0 &amp; ~rx;&#xa;  &#xa;  //----------------------------------------------    &#xa; /*     counter control      */&#xa;  reg cnt_en;&#xa;  always@(posedge clk16x or negedge rst_n)&#xa;  begin&#xa;      if(!rst_n)&#xa;          cnt_en&lt;=1'b0;&#xa;      else if(neg_tri==1'b1)      /*如果捕获到下降沿，则开始计数*/&#xa;          cnt_en&lt;=1'b1;&#xa;      else if(cnt==8'd152)&#xa;          cnt_en&lt;=1'b0;&#xa;     &#xa;  end&#xa;  //---------------------------------------------&#xa;  /*      counter module ，对采样时钟进行计数       */&#xa;  &#xa; always@(posedge clk16x or negedge rst_n)&#xa;  begin&#xa;      if(!rst_n)&#xa;          cnt&lt;=8'd0;&#xa;      else if(cnt_en)&#xa;        //  cnt&lt;=cnt+1'b1;&#xa;       cnt&lt;=cnt+1;&#xa;      else&#xa;          cnt&lt;=8'd0;&#xa;  &#xa;  end&#xa;  //---------------------------------------------&#xa;  /*      receive module        */&#xa;  reg StopBit_r;&#xa;  always@(posedge clk16x or negedge rst_n)&#xa;  begin&#xa;      if(!rst_n)&#xa;          begin&#xa;             DataReceived&lt;=8'b0;&#xa;             count=0;&#xa;         end&#xa;      else if(cnt_en)&#xa;          case(cnt)&#xa;              8'd24: begin  DataReceived[0] &lt;= rx; count=count+1;  end  /*在各个采样时刻，读取接收到的数据*/&#xa;              8'd40: begin  DataReceived[1] &lt;= rx; count=count+1;  end&#xa;              8'd56: begin  DataReceived[2] &lt;= rx; count=count+1;  end&#xa;              8'd72: begin  DataReceived[3] &lt;= rx; count=count+1;  end&#xa;              8'd88: begin  DataReceived[4] &lt;= rx; count=count+1;  end&#xa;              8'd104: begin DataReceived[5] &lt;= rx; count=count+1;  end&#xa;              8'd120: begin DataReceived[6] &lt;= rx; count=count+1;  end&#xa;              8'd136: begin DataReceived[7] &lt;= rx; count=count+1;  end&#xa;              &#xa;          endcase&#xa;  &#xa;  end&#xa;  &#xa;  always@(posedge clk16x or negedge rst_n)&#xa;  begin&#xa;      if(!rst_n)&#xa;          DataReady&lt;=1'b0;&#xa;      else if (cnt==8'd152)&#xa;          DataReady&lt;=1'b1;       //接收到停止位后，给出数据准备好标志位&#xa;      else &#xa;          DataReady&lt;=1'b0;&#xa;  end&#xa;  &#xa;" Height="720" Parameters="" X="0" Parent="0">
 <Port Color="#00ffff" Y="0.322222" Width="20" Name="clk16x" Inout="input" Side="left" Height="20" Function="" Datasize="1" Datatype="wire" X="-0.0195313" Parent="UART"/>
 <Port Color="#7fffd4" Y="0.488889" Width="20" Name="rst_n" Inout="input" Side="left" Height="20" Function="" Datasize="1" Datatype="wire" X="-0.0195313" Parent="UART"/>
 <Port Color="#f0ffff" Y="0.655556" Width="20" Name=" rx" Inout="input" Side="left" Height="20" Function="" Datasize="1" Datatype="wire" X="-0.0195313" Parent="UART"/>
 <Port Color="#cd853f" Y="0.238889" Width="20" Name="DataReady" Inout="output" Side="right" Height="20" Function="" Datasize="1" Datatype="reg" X="0.980469" Parent="UART"/>
 <Port Color="#ffe4c4" Y="0.488889" Width="20" Name="DataReceived" Inout="output" Side="right" Height="20" Function="" Datasize="8" Datatype="reg" X="0.980469" Parent="UART"/>
</Module>
